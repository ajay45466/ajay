
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SyncWatch â€“ Final Stable v6</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#0f0f0f;color:#fff;font-family:Arial}
.hidden{display:none!important}
header{background:#181818;padding:10px 14px;display:flex;justify-content:space-between;align-items:center}
#badge{cursor:pointer}
#badge img{width:32px;height:32px;border-radius:50%;margin-right:6px;vertical-align:middle}
main{display:flex;flex-wrap:wrap}
.video{flex:2;padding:12px}
.side{flex:1;padding:12px;background:#1b1b1b;display:flex;flex-direction:column}
video{width:100%;max-height:60vh;background:#000;border-radius:10px}

/* PANELS */
#users,#chat{border:1px solid #333;border-radius:10px;padding:8px;margin-bottom:8px;overflow:auto}
.user,.msg{display:flex;align-items:center;margin-bottom:6px}
.user img,.msg img{width:32px;height:32px;border-radius:50%;margin-right:6px}

/* CHAT INPUT */
.chat-input{display:flex;gap:6px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:none}
.chat-input button{padding:10px 14px;border:none;border-radius:8px;background:#e50914;color:#fff;font-weight:bold}

/* JOIN */
#join{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999}
.join-card{background:#111;padding:24px;border-radius:16px;width:300px;text-align:center}
.avatar{width:100px;height:100px;border-radius:50%;border:2px dashed #555;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}
.avatar span{font-size:12px;color:#aaa}
.avatar img{width:100%;height:100%;object-fit:cover}
.join-card input{width:100%;padding:10px;border-radius:8px;border:none;margin:8px 0}
.join-card button{width:100%;padding:12px;background:#e50914;border:none;border-radius:10px;color:#fff;font-weight:bold}

/* EDIT PROFILE MODAL */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:10000}
.modal-box{background:#111;padding:20px;border-radius:14px;width:280px;text-align:center}
.modal-box input{width:100%;padding:10px;border-radius:8px;border:none;margin:6px 0}
.modal-box button{padding:10px 14px;border:none;border-radius:8px;margin-top:6px;font-weight:bold}
.save{background:#1f80e0;color:#fff}
.close{background:#444;color:#fff}

/* POPUP */
.popup{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#1f80e0;color:#fff;padding:10px 18px;border-radius:20px;z-index:10001;font-weight:bold}

/* LOGOUT */
.logout{margin-top:100px;padding:12px;background:#e50914;color:#fff;border:none;border-radius:10px;font-weight:bold}
</style>
</head>
<body>

<!-- JOIN -->
<div id="join">
  <div class="join-card">
    <div class="avatar" id="pick"><span>Select DP</span><img id="dp" class="hidden"></div>
    <input id="name" placeholder="Enter name">
    <button id="go">Continue</button>
  </div>
</div>

<!-- EDIT PROFILE -->
<div id="profileModal" class="modal hidden">
  <div class="modal-box">
    <h3>Edit Profile</h3>
    <input id="editName" placeholder="New name">
    <input type="file" id="editDp" accept="image/*">
    <button class="save" onclick="saveProfile()">Save</button>
    <button class="close" onclick="closeProfile()">Cancel</button>
  </div>
</div>

<header>
  <div>ðŸŽ¬ SyncWatch By ajay</div>
  <div id="badge" onclick="openProfile()"></div>
</header>

<main>
  <div class="video">
    <input type="file" id="file" accept="video/*">
    <video id="vid" controls></video>
  </div>

  <div class="side">
    <h4>ðŸ‘¥ Watching</h4>
    <div id="users"></div>

    <h4>ðŸ’¬ Chat</h4>
    <div id="chat"></div>
    <div class="chat-input">
      <input id="msg" placeholder="Message">
      <button id="send">Send</button>
    </div>

    <button class="logout" id="logout">Logout</button>
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig={
 apiKey:"AIzaSyCBcXOdPrmV0j5VpwmNSoWU_62J_7MRtg0",
 authDomain:"sync-watch-6089d.firebaseapp.com",
 databaseURL:"https://sync-watch-6089d-default-rtdb.firebaseio.com",
 projectId:"sync-watch-6089d",
 storageBucket:"sync-watch-6089d.appspot.com",
 messagingSenderId:"681166635054",
 appId:"1:681166635054:web:7411a29e05abac6c8f5fbf"
};
firebase.initializeApp(firebaseConfig);
var db=firebase.database();

var room="room1";
var uid=Math.random().toString(36).slice(2);
var profile=JSON.parse(localStorage.getItem("syncwatch_profile")||"null");

var join=document.getElementById("join");
var nameI=document.getElementById("name");
var pick=document.getElementById("pick");
var dp=document.getElementById("dp");
var badge=document.getElementById("badge");
var users=document.getElementById("users");
var chat=document.getElementById("chat");
var vid=document.getElementById("vid");

function popup(t){
 var p=document.createElement("div");
 p.className="popup";p.textContent=t;
 document.body.appendChild(p);
 setTimeout(()=>p.remove(),2500);
}

/* JOIN */
pick.onclick=function(){
 var i=document.createElement("input");i.type="file";i.accept="image/*";
 i.onchange=function(){
  var r=new FileReader();
  r.onload=function(){
   dp.src=r.result;dp.classList.remove("hidden");
   pick.querySelector("span").style.display="none";
   pick.dataset.a=r.result;
  };
  r.readAsDataURL(i.files[0]);
 };i.click();
};

go.onclick=function(){
 if(!nameI.value.trim()) return alert("Enter name");
 profile={name:nameI.value.trim(),avatar:pick.dataset.a||null};
 localStorage.setItem("syncwatch_profile",JSON.stringify(profile));
 start();
};

function start(){
 join.classList.add("hidden");
 badge.innerHTML=profile.avatar?'<img src="'+profile.avatar+'">'+profile.name:profile.name;

 var uref=db.ref("rooms/"+room+"/users/"+uid);
 uref.set(profile); uref.onDisconnect().remove();

 db.ref("rooms/"+room+"/users").on("value",snap=>{
  users.innerHTML="";
  snap.forEach(c=>{
   var d=document.createElement("div");
   d.className="user";
   d.innerHTML='<img src="'+(c.val().avatar||"https://via.placeholder.com/60")+'">'+c.val().name;
   users.appendChild(d);
  });
 });

 db.ref("rooms/"+room+"/chat").on("value",snap=>{
  chat.innerHTML="";
  snap.forEach(c=>{
   var m=document.createElement("div");
   m.className="msg";
   m.innerHTML='<img src="'+(c.val().avatar||"https://via.placeholder.com/60")+'"><span>'+c.val().name+': '+c.val().text+'</span>';
   chat.appendChild(m);
  });
 });

 db.ref("rooms/"+room+"/uploads").on("child_added",snap=>{
  popup(snap.val().name+" uploaded video");
 });

 db.ref("rooms/"+room+"/sync").on("value",snap=>{
  var s=snap.val(); if(!s||s.uid===uid) return;
  if(Math.abs(vid.currentTime-s.time)>0.3){ vid.currentTime=s.time; }
  if(s.playing && vid.paused) vid.play();
  if(!s.playing && !vid.paused) vid.pause();
 });
}

if(profile&&profile.name){ start(); }

file.onchange=function(e){
 vid.src=URL.createObjectURL(e.target.files[0]);
 db.ref("rooms/"+room+"/uploads").push({name:profile.name});
};

setInterval(function(){
 if(!vid.src) return;
 db.ref("rooms/"+room+"/sync").set({
  time:vid.currentTime,
  playing:!vid.paused,
  uid:uid
 });
},1000);

/* CHAT SEND */
send.onclick=function(){
 if(!msg.value) return;
 db.ref("rooms/"+room+"/chat").push({name:profile.name,avatar:profile.avatar,text:msg.value});
 msg.value="";
};

/* EDIT PROFILE */
function openProfile(){
 document.getElementById("editName").value=profile.name;
 document.getElementById("profileModal").classList.remove("hidden");
}
function closeProfile(){
 document.getElementById("profileModal").classList.add("hidden");
}
function saveProfile(){
 var newName=document.getElementById("editName").value.trim();
 var file=document.getElementById("editDp").files[0];
 if(newName) profile.name=newName;

 if(file){
  var r=new FileReader();
  r.onload=function(){
   profile.avatar=r.result;
   finishSave();
  };
  r.readAsDataURL(file);
 }else{
  finishSave();
 }
}
function finishSave(){
 localStorage.setItem("syncwatch_profile",JSON.stringify(profile));
 db.ref("rooms/"+room+"/users/"+uid).set(profile);
 badge.innerHTML=profile.avatar?'<img src="'+profile.avatar+'">'+profile.name:profile.name;
 closeProfile();
}

logout.onclick=function(){
 localStorage.removeItem("syncwatch_profile");
 location.reload();
};
</script>
</body>
</html>

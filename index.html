
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SyncWatch ‚Äì Final Stable v2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#0f0f0f;color:#fff;font-family:Arial}
.hidden{display:none!important}
header{background:#181818;padding:10px 14px;display:flex;justify-content:space-between;align-items:center}
#badge img{width:32px;height:32px;border-radius:50%;margin-right:6px;vertical-align:middle}
main{display:flex;flex-wrap:wrap}
.video{flex:2;padding:12px}
.side{flex:1;padding:12px;background:#1b1b1b;display:flex;flex-direction:column}
video{width:100%;max-height:60vh;background:#000;border-radius:10px}
.controls button{padding:10px 16px;border:none;border-radius:10px;color:#fff;font-weight:bold;margin-right:6px}
.mic{background:#e50914}.spk{background:#1f80e0}
#users,#chat{border:1px solid #333;border-radius:10px;padding:8px;margin-bottom:8px;overflow:auto}
.user,.msg{display:flex;align-items:center;margin-bottom:6px;cursor:pointer}
.user img,.msg img{width:32px;height:32px;border-radius:50%;margin-right:6px}
.chat-input{display:flex;gap:6px;position:relative}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:none}
.chat-input button{padding:10px 14px;border:none;border-radius:8px;background:#e50914;color:#fff}
.emoji-btn{width:40px;height:40px;border-radius:50%;background:#2a2a2a;color:#fff;font-size:20px;border:none}
.emoji-picker{position:absolute;bottom:50px;left:0;background:#222;border:1px solid #333;border-radius:10px;padding:8px;display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
.emoji-picker span{cursor:pointer;font-size:20px;text-align:center}

/* JOIN */
#join{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999}
.join-card{background:#111;padding:24px;border-radius:16px;width:300px;text-align:center}
.avatar{width:100px;height:100px;border-radius:50%;border:2px dashed #555;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}
.avatar span{font-size:12px;color:#aaa}
.avatar img{width:100%;height:100%;object-fit:cover}
.join-card input{width:100%;padding:10px;border-radius:8px;border:none;margin:8px 0}
.join-card button{width:100%;padding:12px;background:#e50914;border:none;border-radius:10px;color:#fff;font-weight:bold;cursor:pointer}

/* MODAL (DP VIEW + PROFILE UPDATE) */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  display:flex;align-items:center;justify-content:center;z-index:10000;
}
.modal-content{
  background:#111;padding:20px;border-radius:16px;max-width:90%;text-align:center;
}
.modal-content img{max-width:90vw;max-height:70vh;border-radius:12px}
.modal-content input{width:100%;padding:10px;border-radius:8px;border:none;margin:8px 0}
.modal-content button{padding:10px 16px;margin-top:6px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.save{background:#1f80e0;color:#fff}
.close{background:#444;color:#fff}

/* LOGOUT */
.logout{
  margin-top:auto;
  padding:12px;
  background:#e50914;
  color:#fff;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>
<body>

<!-- JOIN -->
<div id="join">
  <div class="join-card">
    <div class="avatar" id="pick">
      <span>Select your DP Babe üòö</span>
      <img id="dp" class="hidden">
    </div>
    <input id="name" placeholder="Enter name">
    <button id="go">Continue</button>
  </div>
</div>

<!-- DP VIEW MODAL -->
<div id="dpModal" class="modal hidden">
  <div class="modal-content">
    <img id="dpView">
    <br>
    <button class="close" onclick="closeDP()">Close</button>
  </div>
</div>

<!-- PROFILE UPDATE MODAL -->
<div id="profileModal" class="modal hidden">
  <div class="modal-content">
    <h3>Update Profile</h3>
    <input id="newName" placeholder="Enter new name">
    <input type="file" id="newDp" accept="image/*">
    <button class="save" onclick="saveProfile()">Save</button>
    <br>
    <button class="close" onclick="closeProfile()">Cancel</button>
  </div>
</div>

<header>
  <div>üé¨ SyncWatch By Ajay Bhole</div>
  <div id="badge" onclick="openProfile()"></div>
</header>

<main>
  <div class="video">
    <input type="file" id="file" accept="video/*">
    <video id="vid" controls></video>
    <div class="controls">
      <button class="mic">Mic</button>
      <button class="spk" id="spk">Speaker</button>
    </div>
  </div>

  <div class="side">
    <h4>üë• Watching</h4>
    <div id="users"></div>

    <h4>üí¨ Chat</h4>
    <div id="chat"></div>

    <div class="chat-input">
      <button class="emoji-btn" id="emojiBtn">üòä</button>
      <input id="msg" placeholder="Message">
      <button id="send">Send</button>
      <div id="emojiPicker" class="emoji-picker hidden"></div>
    </div>

    <button class="logout" id="logout">Logout</button>
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyCBcXOdPrmV0j5VpwmNSoWU_62J_7MRtg0",
  authDomain: "sync-watch-6089d.firebaseapp.com",
  databaseURL: "https://sync-watch-6089d-default-rtdb.firebaseio.com",
  projectId: "sync-watch-6089d",
  storageBucket: "sync-watch-6089d.appspot.com",
  messagingSenderId: "681166635054",
  appId: "1:681166635054:web:7411a29e05abac6c8f5fbf"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var room="room1";
var uid=Math.random().toString(36).slice(2);
var profile=JSON.parse(localStorage.getItem("syncwatch_profile")||"null");

var join=document.getElementById("join");
var nameI=document.getElementById("name");
var pick=document.getElementById("pick");
var dp=document.getElementById("dp");
var badge=document.getElementById("badge");
var users=document.getElementById("users");

pick.onclick=function(){
  var i=document.createElement("input");i.type="file";i.accept="image/*";
  i.onchange=function(){
    var r=new FileReader();
    r.onload=function(){
      dp.src=r.result;dp.classList.remove("hidden");
      pick.querySelector("span").style.display="none";
      pick.dataset.a=r.result;
    };
    r.readAsDataURL(i.files[0]);
  };i.click();
};

document.getElementById("go").onclick=function(){
  if(!nameI.value.trim()) return alert("Enter name");
  profile={name:nameI.value.trim(),avatar:pick.dataset.a||null};
  localStorage.setItem("syncwatch_profile",JSON.stringify(profile));
  start();
};

function start(){
  join.classList.add("hidden");
  badge.innerHTML=profile.avatar?'<img src="'+profile.avatar+'">'+profile.name:profile.name;

  var uref=db.ref("rooms/"+room+"/users/"+uid);
  uref.set(profile); uref.onDisconnect().remove();

  db.ref("rooms/"+room+"/users").on("value",function(snap){
    users.innerHTML="";
    snap.forEach(function(c){
      var d=document.createElement("div");
      d.className="user";
      d.innerHTML='<img src="'+(c.val().avatar||"https://via.placeholder.com/60")+'">'+c.val().name;
      d.onclick=function(){ showDP(c.val().avatar); };
      users.appendChild(d);
    });
  });

  db.ref("rooms/"+room+"/chat").on("value",function(snap){
    chat.innerHTML="";
    snap.forEach(function(c){
      var m=document.createElement("div");
      m.className="msg";
      m.innerHTML='<img src="'+(c.val().avatar||"https://via.placeholder.com/60")+'"><span>'+c.val().name+': '+c.val().text+'</span>';
      m.onclick=function(){ showDP(c.val().avatar); };
      chat.appendChild(m);
    });
  });
}

if(profile&&profile.name){ start(); }

document.getElementById("send").onclick=function(){
  if(!msg.value) return;
  db.ref("rooms/"+room+"/chat").push({name:profile.name,avatar:profile.avatar,text:msg.value});
  msg.value="";
};

var emojiBtn=document.getElementById("emojiBtn");
var emojiPicker=document.getElementById("emojiPicker");
var emojis=["üòÄ","üòÅ","üòÇ","ü§£","üòä","üòç","üòò","üòé","ü§î","üò¢","üò≠","üò°","üëç","üëé","üî•","üéâ","‚ù§Ô∏è","üíØ"];
emojis.forEach(function(e){
  var s=document.createElement("span");
  s.textContent=e;
  s.onclick=function(){
    db.ref("rooms/"+room+"/chat").push({name:profile.name,avatar:profile.avatar,text:e});
    emojiPicker.classList.add("hidden");
  };
  emojiPicker.appendChild(s);
});
emojiBtn.onclick=function(){emojiPicker.classList.toggle("hidden");};

document.getElementById("file").onchange=function(e){vid.src=URL.createObjectURL(e.target.files[0]);};
document.getElementById("spk").onclick=function(){vid.muted=!vid.muted;};

document.getElementById("logout").onclick=function(){
  localStorage.removeItem("syncwatch_profile");
  location.reload();
};

/* DP FULL VIEW */
function showDP(src){
  if(!src) return;
  document.getElementById("dpView").src=src;
  document.getElementById("dpModal").classList.remove("hidden");
}
function closeDP(){ document.getElementById("dpModal").classList.add("hidden"); }

/* PROFILE UPDATE */
function openProfile(){
  document.getElementById("newName").value=profile.name;
  document.getElementById("profileModal").classList.remove("hidden");
}
function closeProfile(){ document.getElementById("profileModal").classList.add("hidden"); }

function saveProfile(){
  var newName=document.getElementById("newName").value.trim();
  var file=document.getElementById("newDp").files[0];
  if(newName) profile.name=newName;

  if(file){
    var r=new FileReader();
    r.onload=function(){
      profile.avatar=r.result;
      finishSave();
    };
    r.readAsDataURL(file);
  }else{
    finishSave();
  }
}

function finishSave(){
  localStorage.setItem("syncwatch_profile",JSON.stringify(profile));
  db.ref("rooms/"+room+"/users/"+uid).set(profile);
  badge.innerHTML=profile.avatar?'<img src="'+profile.avatar+'">'+profile.name:profile.name;
  closeProfile();
}
</script>
</body>
</html>
